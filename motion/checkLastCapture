#!/bin/bash
set -eu

if [ $# -ne 1 ]; then
    echo "Usage: $0 capturesDir"
    exit 1
fi

CAPDIR=$1

# Get last capture
CAPFILE=$(ls -t $CAPDIR | head -1)
if [ -n "$CAPFILE" ]; then
    CAPTIME=`date -r "$CAPDIR/$CAPFILE"`
    echo "Last motion was captured at $CAPTIME"

    # Remove all other captures, assumes filenames have no newlines
    ls -dt $CAPDIR/* | tail -n +2 | xargs --null -r -d "\n" rm
else
    echo "No captures found in $CAPDIR"
fi
